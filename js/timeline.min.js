!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?module.exports=e:e(jQuery)}(function(e){function t(t){var s=t||window.event,a=h.call(arguments,1),r=0,f=0,d=0,c=0,m=0,g=0;if(t=e.event.fix(s),t.type="mousewheel","detail"in s&&(d=-1*s.detail),"wheelDelta"in s&&(d=s.wheelDelta),"wheelDeltaY"in s&&(d=s.wheelDeltaY),"wheelDeltaX"in s&&(f=-1*s.wheelDeltaX),"axis"in s&&s.axis===s.HORIZONTAL_AXIS&&(f=-1*d,d=0),r=0===d?f:d,"deltaY"in s&&(d=-1*s.deltaY,r=d),"deltaX"in s&&(f=s.deltaX,0===d&&(r=-1*f)),0!==d||0!==f){if(1===s.deltaMode){var w=e.data(this,"mousewheel-line-height");r*=w,d*=w,f*=w}else if(2===s.deltaMode){var v=e.data(this,"mousewheel-page-height");r*=v,d*=v,f*=v}if(c=Math.max(Math.abs(d),Math.abs(f)),(!l||l>c)&&(l=c,i(s,c)&&(l/=40)),i(s,c)&&(r/=40,f/=40,d/=40),r=Math[r>=1?"floor":"ceil"](r/l),f=Math[f>=1?"floor":"ceil"](f/l),d=Math[d>=1?"floor":"ceil"](d/l),u.settings.normalizeOffset&&this.getBoundingClientRect){var p=this.getBoundingClientRect();m=t.clientX-p.left,g=t.clientY-p.top}return t.deltaX=f,t.deltaY=d,t.deltaFactor=l,t.offsetX=m,t.offsetY=g,t.deltaMode=0,a.unshift(t,r,f,d),o&&clearTimeout(o),o=setTimeout(n,200),(e.event.dispatch||e.event.handle).apply(this,a)}}function n(){l=null}function i(e,t){return u.settings.adjustOldDeltas&&"mousewheel"===e.type&&t%120===0}var o,l,s=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],a="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],h=Array.prototype.slice;if(e.event.fixHooks)for(var r=s.length;r;)e.event.fixHooks[s[--r]]=e.event.mouseHooks;var u=e.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var n=a.length;n;)this.addEventListener(a[--n],t,!1);else this.onmousewheel=t;e.data(this,"mousewheel-line-height",u.getLineHeight(this)),e.data(this,"mousewheel-page-height",u.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var n=a.length;n;)this.removeEventListener(a[--n],t,!1);else this.onmousewheel=null;e.removeData(this,"mousewheel-line-height"),e.removeData(this,"mousewheel-page-height")},getLineHeight:function(t){var n=e(t),i=n["offsetParent"in e.fn?"offsetParent":"parent"]();return i.length||(i=e("body")),parseInt(i.css("fontSize"),10)||parseInt(n.css("fontSize"),10)||16},getPageHeight:function(t){return e(t).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};e.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})});
function Rainbow(){function r(r){if(r.length<2)throw new Error("Rainbow must have two or more colours.");var f=(e-n)/(r.length-1),i=new ColourGradient;i.setGradient(r[0],r[1]),i.setNumberRange(n,n+f),t=[i];for(var u=1;u<r.length-1;u++){var a=new ColourGradient;a.setGradient(r[u],r[u+1]),a.setNumberRange(n+f*u,n+f*(u+1)),t[u]=a}return o=r,this}var t=null,n=0,e=100,o=["ff0000","ffff00","00ff00","0000ff"];r(o),this.setColors=this.setColours,this.setSpectrum=function(){return r(arguments),this},this.setSpectrumByArray=function(t){return r(t),this},this.colourAt=function(r){if(isNaN(r))throw new TypeError(r+" is not a number");if(1===t.length)return t[0].colourAt(r);var o=(e-n)/t.length,f=Math.min(Math.floor((Math.max(r,n)-n)/o),t.length-1);return t[f].colourAt(r)},this.colorAt=this.colourAt,this.setNumberRange=function(t,f){if(!(f>t))throw new RangeError("maxNumber ("+f+") is not greater than minNumber ("+t+")");return n=t,e=f,r(o),this}}function ColourGradient(){function r(r,t,n){var e=r;f>e&&(e=f),e>i&&(e=i);var o=i-f,u=parseInt(t,16),a=parseInt(n,16),s=(a-u)/o,h=Math.round(s*(e-f)+u);return formatHex(h.toString(16))}function t(r){var t=/^#?[0-9a-fA-F]{6}$/i;return t.test(r)}function n(r){if(t(r))return r.substring(r.length-6,r.length);for(var n=[["red","ff0000"],["lime","00ff00"],["blue","0000ff"],["yellow","ffff00"],["orange","ff8000"],["aqua","00ffff"],["fuchsia","ff00ff"],["white","ffffff"],["black","000000"],["gray","808080"],["grey","808080"],["silver","c0c0c0"],["maroon","800000"],["olive","808000"],["green","008000"],["teal","008080"],["navy","000080"],["purple","800080"]],e=0;e<n.length;e++)if(r.toLowerCase()===n[e][0])return n[e][1];throw new Error(r+" is not a valid colour.")}var e="ff0000",o="0000ff",f=0,i=100;this.setGradient=function(r,t){e=n(r),o=n(t)},this.setNumberRange=function(r,t){if(!(t>r))throw new RangeError("maxNumber ("+t+") is not greater than minNumber ("+r+")");f=r,i=t},this.colourAt=function(t){return r(t,e.substring(0,2),o.substring(0,2))+r(t,e.substring(2,4),o.substring(2,4))+r(t,e.substring(4,6),o.substring(4,6))},formatHex=function(r){return 1===r.length?"0"+r:r}}
!function(t){t.fn.timeline=function(e){function a(t){var e;e=y()?20+70*Math.random()+"%":10+60*Math.random()+"%",n({content:S.templateEvent.replace("[title]",t.title).replace("[date]",f(t.date)).replace("[description]",t.description).replace(/\[link\]/g,t.link).replace("[image]",t.image?'<img src="'+t.image+'"/>':""),start:t.date.start,end:t.date.end?t.date.end:t.date.start,title:t.title,offset:e},"event"+(!0===t.keyEvent?" key-event":"")+(t.image?" has-img":"")+(t.class?" "+t.class:""))}function n(e,a,n){var i,d,s,l=v(e,n),r=N;if(y()?(i="top",d="left",s="height"):(i="left",d="top",s="width"),void 0!==n&&(r=n.find("main")),null!==l[s]){if(e.$div=t("<div></div>").appendTo(r).css(i,l[i]+("left"==i?r.scrollLeft():r.scrollTop())).css(d,e.offset?e.offset:null).css(s,l[s]).data("data",e).html("<h2>"+e.title+"</h2>"+(e.content?"<div>"+e.content+"</div>":"")).click(M),a&&e.$div.addClass(a),e.class&&e.$div.addClass(e.class),!e.$div.hasClass("event"))switch(S.colorMode){case"rainbow":e.$div.css({backgroundColor:"rainbow"==S.colorMode?E():x()});break;case"random":e.$div.css({backgroundColor:x()})}e.interval&&o(e)}}function o(e){if(e.interval){var a=S.layoutMode==A?"height":"width",n=S.layoutMode==A?"top":"left",o=t('<ul class="scale"></ul>').css(a,"width"==a?e.$div.width():e.$div.height()).appendTo(e.$div);t(e.interval).each(function(a,i){o.append(t("<li></li>").css(n,"left"==n?m(i)-e.$div.offset().left:m(i)-e.$div.offset().top).html(c(i)))})}}function i(){B.html("")}function d(){var e=this;return null===S.layoutMode&&(S.layoutMode=B.height()>B.width()?A:z),B.addClass(S.layoutMode===A?"vertical":"horizontal"),B.addClass("loading"),g(),S.data&&(t(S.data).each(function(t,e){a(e)}),B.removeClass("loading")),t(S.src).each(function(t,a){setTimeout(function(){a.loadFunction&&a.url?a.loadFunction.call(e,a.url,e):S.loadFunction?S.loadFunction.call(e,a,e):w(a)},500*t)}),this}function s(e,a){var n=!0;return t.each(["day","month","year"],function(t,o){return e[o]!=a[o]?(n=!1,void 0):void 0}),n}function l(t,e,a){var n=void 0!==t.year?t.year:t,o=void 0!==e.year?e.year:e,i=void 0!==a.year?a.year:a;return n>=o&&i>=n}function r(t){window.console&&window.console.log&&window.console.log(t)}function c(t){if(!t.year)return u(t);if(t.format)return t.format.replace("y",t.year).replace("m",S.monthNames[t.month-1]).replace("d",t.day);var e=u(t.year);return t.month&&(e=S.monthNames[t.month-1]+" "+e),t.day&&(e=t.day+" "+e),e}function u(t){var e=t;return Math.abs(t)>=1e6?e=(Math.abs(t/1e6).toFixed(1)+"m yrs").replace(".0",""):Math.abs(t)>1e4&&(e=h(Math.abs(t))),0>t&&(e+=" BC"),e}function h(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function f(t){var e=[c(t.start)];return t.end&&(s(t.start,t.end)||e.push(c(t.end))),e.join(" to ")}function m(e){var a,n=e.year?e.year:e,o=y()?"top":"left";return e.month&&e.day?n=365*n+30*e.month+e.day:e.month&&(n=12*n+e.month),t(S.timescales).each(function(t,i){var d=i.start,s=i.end;e.month&&e.day?(d*=365,s*=365):e.month&&(d*=12,s*=12);var l=i.width/(s-d);return n>=d&&s>n?(a=i.$div.offset()[o]+(n-d)*l,void 0):void 0}),a}function p(t){var e=S.layoutMode;t!==A&&(t=z),t!==e&&(r(t),i(),d())}function v(e,a){var n={left:null,width:0},o=S.timescales,i=e.start.year?e.start.year:e.start,d=e.end.year?e.end.year:e.end,s=y()?"top":"left";return e.start.month&&e.start.day&&(i=365*i+30*e.start.month+e.start.day,d=365*d+30*e.end.month+e.end.day),void 0!==a&&(o=[{$div:a,start:a.data("data").start,end:a.data("data").end,width:a.width()}]),t(o).each(function(t,a){var o=a.start,l=a.end;e.start.month&&e.start.day&&(o*=365,l*=365);var r=a.width/(l-o);i>=o&&l>i&&(n[s]=a.$div.position()[s]+(i-o)*r),i>l||o>d||(i>o&&l>d?n.width+=(d-i)*r:i>=o&&d>=l?n.width+=(l-i)*r:o>i&&d>l?n.width+=a.width:o>=i&&l>=d&&(n.width+=(d-o)*r))}),n}function y(){return S.layoutMode===A}function g(){p(S.layoutMode);var e=y()?"top":"left",a=y()?"height":"width";R.setNumberRange(0,S.timescales.length),S.colors&&R.setSpectrumByArray(S.colors),N=t("<main></main>").appendTo(B),t(S.timescales).each(function(n,i){S.timescales[n][e]=0===n?0:N.children().last().position()[e]+("left"===e?N.children().last().width():N.children().last().height()),S.timescales[n].$div=t('<div class="timespan"><h1>'+u(i.start)+"</h1></div>").addClass(i.class).appendTo(N).css("backgroundColor","rainbow"===S.colorMode?"#"+R.colorAt(n):E()).css(e,S.timescales[n][e]).css(a,i.width).data("data",i),o(S.timescales[n])}),t(S.periods).each(function(t,e){e.class=e.class?"period "+e.class:"period",n(e)}),S.startDate&&D(S.startDate),N.mousedown(b).keydown(k).keyup(C).mousewheel(function(t){t.preventDefault(),j(100*t.deltaY)}).attr("tabindex",1).focus().find(">div").dblclick($),t(window).resize(function(){})}function w(e,n){B.addClass("loading"),t.ajax({dataType:"json",success:function(e){t(e).each(function(t,e){a(e)}),S.data=S.data.concat(e),B.removeClass("loading"),void 0!==n&&n()},url:e})}function b(e){var a,n;S.layoutMode==A?(a=e.clientY,n=N.scrollTop(),N.mousemove(function(t){N.scrollTop(n-(t.clientY-a))}).mouseup(function(e){t(e.currentTarget).unbind("mousemove").unbind("mouseup")})):(a=e.clientX,n=N.scrollLeft(),N.mousemove(function(t){N.scrollLeft(n-(t.clientX-a))}).mouseup(function(e){t(e.currentTarget).unbind("mousemove").unbind("mouseup")}))}function M(e){var a=t(e.currentTarget),n=a.closest("main"),o=n.width()-n.scrollLeft()<a.offset().left+a.find("h2").width(),i=n.height()/2<a.offset().top;a.removeClass("right").removeClass("bottom").toggleClass("active"),o&&a.addClass("right"),i&&a.addClass("bottom")}function k(t){if(y())switch(t.keyCode){case 38:F(N.height()/4);break;case 40:F(-N.height()/4)}else switch(t.keyCode){case 37:F(N.width()/4);break;case 39:F(-N.width()/4)}}function C(t){}function T(e){var a=t(e.currentTarget).closest(".clone");t(".clone").css({left:-1+N.scrollLeft(),position:"absolute"}).animate({height:a.data("owner").height(),left:a.data("owner").offset().left+N.scrollLeft(),opacity:0,top:a.data("owner").offset().top,width:a.data("owner").width()},function(){a.remove(),B.removeClass("zoomed")})}function $(e){if(S.enableRegionExpand){t(".clone button").trigger("click");var a=t(e.currentTarget),o=a.clone(!0).css({backgroundColor:""}).attr("tabindex",1).addClass("clone").removeClass("rotate").unbind().appendTo(N).animate({height:B.height(),left:-1+N.scrollLeft(),top:0,width:B.width()+2},function(){B.addClass("zoomed"),t(this).css({left:-1,position:"fixed"}),t(S.data).each(function(t,e){l(e.date.start,o.data("data").start,o.data("data").end)&&n({content:S.templateEvent.replace("[title]",e.title).replace("[date]",f(e.date)).replace("[description]",e.description).replace(/\[link\]/g,e.link).replace("[image]",e.image?'<img src="'+e.image+'"/>':""),start:e.date.start,end:e.date.end?e.date.end:e.date.start,title:e.title,top:10+50*Math.random()+"%"},"event"+(!0===e.keyEvent?" key-event":"")+(e.image?" has-img":""),o)})}).data("owner",a).append(t("<button></button>").click(T)).prepend("<main></main>").keydown(L).focus(),i=o.find("ul").width();o.find("ul").css({width:"100%"}).children().each(function(e,a){t(a).css({left:100*(t(a).position().left/i)+"%"})}),a.data("data").name&&a.data("data").start&&a.data("data").end&&(o.append('<div class="label start">'+u(a.data("data").start)+"</div>"),o.append('<div class="label end">'+u(a.data("data").end)+"</div>")),J=!1}}function L(t){switch(t.keyCode){case 27:T(t)}}function x(){for(var t=[],e=0;2>=e;e++)t.push(Math.round(255*Math.random()));return"rgba("+t.join(",")+",0.5)"}function E(){return"rgba(0,0,0,"+(0+.1*Math.random())+")"}function F(t){S.layoutMode==A?N.stop().animate({scrollTop:N.scrollTop()-t}):N.stop().animate({scrollLeft:N.scrollLeft()-t})}function j(t){S.layoutMode==A?N.scrollTop(N.scrollTop()-t):N.scrollLeft(N.scrollLeft()-t)}function D(t){var e;S.layoutMode==A?(e=B.parent().width()/2-m(t),F(e)):(e=B.parent().height()/2-m(t),F(e))}var N,z=0,A=1,B=t(this),J=!1,R=new Rainbow,S=t.extend({colorMode:"",data:[],layoutMode:null,monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],src:[],templateEvent:'<span class="date">[date]</span><span class="description">[image][description]</span><a href="[link]" target="_blank">More...</a>'},e);return this.each(function(){d.call(this),this.addItem=function(e){e=t.extend({title:"",description:"",date:{start:{year:null,month:null,day:null},end:{year:null,month:null,day:null}},link:"",image:"","class":"",keyEvent:!1,top:null},e),a(e)},this.gotoDate=function(t){D(t)}})}}(jQuery);